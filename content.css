/* content.css */
#gpt-queue-panel {
  position: fixed;
  right: 16px;
  top: 72px; /* dock under header */
  z-index: 2147483647;
  width: 320px;
  max-height: 50vh;
  font: 13px/1.3 system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji", "Segoe UI Emoji";
  color: var(--text-primary, #eaeaea);
  background: var(--main-surface-background, rgba(20,20,20,0.92));
  border: 1px solid var(--border-light, rgba(255,255,255,0.06));
  border-radius: 10px;
  box-shadow: 0 8px 24px rgba(0,0,0,0.35);
  overflow: hidden;
  user-select: none;
}

#gpt-queue-panel .gqp-head {
  display: flex; align-items: center; justify-content: space-between;
  padding: 8px 10px; background: rgba(255,255,255,0.04);
}
#gpt-queue-panel .gqp-title { font-weight: 600; }

#gpt-queue-panel .gqp-actions { display: flex; gap: 6px; }
#gpt-queue-panel .gqp-btn {
  border: none; background: transparent; color: inherit; cursor: pointer; padding: 4px 6px;
  border-radius: 6px;
}
#gpt-queue-panel .gqp-btn:hover { background: rgba(255,255,255,0.08); }
/* icon sizing */
#gpt-queue-panel .gqp-btn svg { width: 16px; height: 16px; display: block; }

#gpt-queue-panel .gqp-body { padding: 10px; display: grid; gap: 8px; }
#gpt-queue-panel .gqp-row { display: grid; grid-template-columns: 1fr auto; gap: 8px; }
#gpt-queue-panel .gqp-input {
  border: 1px solid var(--border-light, rgba(255,255,255,0.1)); background: var(--composer-surface, rgba(0,0,0,0.25)); color: var(--text-primary, #eee);
  padding: 8px 10px; border-radius: 8px; outline: none;
}
#gpt-queue-panel .gqp-add {
  padding: 8px 12px; border-radius: 8px; border: 1px solid var(--border-light, rgba(255,255,255,0.1));
  background: var(--interactive-bg-secondary-hover, rgba(255,255,255,0.08)); color: var(--text-primary, #fff); cursor: pointer;
}
#gpt-queue-panel .gqp-add:hover { background: var(--interactive-bg-secondary-press, rgba(255,255,255,0.16)); }

#gpt-queue-panel .gqp-list {
  list-style: none; margin: 0; padding: 0; overflow: auto; max-height: 28vh; display: grid; gap: 6px;
}
#gpt-queue-panel .gqp-item {
  display: grid; grid-template-columns: auto 1fr auto; align-items: center; gap: 8px;
  padding: 8px; border: 1px solid var(--border-light, rgba(255,255,255,0.06)); border-radius: 8px; background: var(--interactive-bg-secondary-hover, rgba(255,255,255,0.03));
}
#gpt-queue-panel .gqp-num { width: 1.5em; text-align: center; opacity: 0.7; font-variant-numeric: tabular-nums; }
#gpt-queue-panel .gqp-text { white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
#gpt-queue-panel .gqp-text.gqp-editing { background: rgba(255,255,255,0.06); outline: 1px solid var(--border-light, rgba(255,255,255,0.12)); border-radius: 4px; padding: 2px 4px; }

#gpt-queue-panel .gqp-foot { display: flex; justify-content: space-between; color: #a8a8a8; font-size: 12px; }
#gpt-queue-panel .gqp-status { font-weight: 600; }
#gpt-queue-panel .gqp-hint { opacity: 0.8; }

#gpt-queue-panel.gqp-collapsed .gqp-body { display: none; }
#gpt-queue-panel[data-paused="true"] .gqp-status::after { content: " (paused)"; color: #ffcf66; }

/* Header queue button (next to Share) */
#gqp-header-queue-btn {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: 6px;
  height: 36px;
  min-width: 36px;
  padding: 0 10px;
  border-radius: 100px; /* fully rounded trigger */
  background: transparent;
  border: 1px solid transparent;
  color: var(--text-primary, #eaeaea);
  position: relative;
}
#gqp-header-queue-btn:hover { background: var(--surface-hover, rgba(255,255,255,0.08)); }
#gqp-header-queue-btn .label { font-size: 14px; }
#gqp-header-queue-btn svg { display: block; }

/* Blue dot indicator when queue has items */
#gqp-header-queue-btn[data-has-items="true"]::after {
  content: "";
  position: absolute;
  top: 2px;
  right: 2px;
  width: 8px;
  height: 8px;
  background: var(--icon-accent, #3b82f6); /* blue */
  border-radius: 50%;
  box-shadow: 0 0 0 2px var(--bg-primary, #111);
}

/* Popover */
#gpt-queue-popover {
  position: absolute;
  z-index: 2147483647;
  width: 360px;
  max-height: 60vh;
  color: var(--text-primary, #eaeaea);
  background: var(--main-surface-background, rgba(20,20,20,0.98));
  border: 1px solid var(--border-light, rgba(255,255,255,0.08));
  border-radius: 1rem; /* rounded popover per request */
  box-shadow: 0 12px 28px rgba(0,0,0,0.45);
  overflow: hidden;
}
#gpt-queue-popover .gqp-foot { display: flex; justify-content: space-between; align-items: center; }
#gpt-queue-popover .gqp-status { display: inline-flex; align-items: center; gap: 6px; font-weight: 600; text-transform: capitalize; }
#gpt-queue-popover .gqp-status::before { content: ""; width: 8px; height: 8px; border-radius: 50%; background: var(--icon-secondary, #cdcdcd); }
#gpt-queue-popover[data-state="busy"] .gqp-status::before { background: var(--icon-accent, #0285ff); }
#gpt-queue-popover[data-state="paused"] .gqp-status::before { background: var(--text-status-warning, #e25507); }
#gpt-queue-popover.hidden { display: none; }
#gpt-queue-popover .gqp-body { padding: 10px; display: grid; gap: 8px; }
#gpt-queue-popover .gqp-row { display: grid; grid-template-columns: 1fr auto; gap: 8px; }
#gpt-queue-popover .gqp-list { list-style: none; margin: 0; padding: 0; overflow: auto; max-height: 40vh; display: grid; gap: 6px; }
#gpt-queue-popover .gqp-item { display: grid; grid-template-columns: auto 1fr auto; align-items: center; gap: 8px; padding: 8px; border: 1px solid var(--border-light, rgba(255,255,255,0.06)); border-radius: 8px; background: var(--interactive-bg-secondary-hover, rgba(255,255,255,0.04)); }
#gpt-queue-popover .gqp-num { width: 1.5em; text-align: center; opacity: 0.7; font-variant-numeric: tabular-nums; }
#gpt-queue-popover .gqp-text.gqp-editing { background: rgba(255,255,255,0.06); outline: 1px solid var(--border-light, rgba(255,255,255,0.12)); border-radius: 4px; padding: 2px 4px; }
#gpt-queue-popover .gqp-input { border: 1px solid var(--border-light, rgba(255,255,255,0.1)); background: var(--composer-surface, rgba(0,0,0,0.25)); color: var(--text-primary, #eee); padding: 8px 10px; border-radius: 8px; outline: none; }
#gpt-queue-popover .gqp-add { padding: 8px 12px; border-radius: 8px; border: 1px solid var(--border-light, rgba(255,255,255,0.1)); background: var(--interactive-bg-secondary-hover, rgba(255,255,255,0.08)); color: var(--text-primary, #fff); cursor: pointer; }
#gpt-queue-popover .gqp-add:hover { background: var(--interactive-bg-secondary-press, rgba(255,255,255,0.16)); }

/* PowerChat: link reference token */
.pc-ref { display: inline-flex; align-items: center; gap: 6px; padding: 2px 8px; border-radius: 999px; background: rgba(255,255,255,0.08); border: 1px solid var(--border-light, rgba(255,255,255,0.12)); color: var(--text-primary, #eaeaea); }
.pc-ref .pc-ref-badge { font-weight: 600; opacity: 0.9; }
.pc-ref .pc-ref-host { opacity: 0.85; }
.pc-ref[contenteditable="false"] { user-select: none; }

/* ========================================
   Token Counter
   ======================================== */
#pc-token-counter {
  position: fixed;
  bottom: 120px;
  right: 24px;
  z-index: 9999;
  display: flex;
  align-items: center;
  gap: 4px;
  padding: 4px 10px;
  border-radius: 20px;
  background: var(--main-surface-background, rgba(30,30,30,0.9));
  border: 1px solid var(--border-light, rgba(255,255,255,0.1));
  color: var(--text-secondary, #888);
  font: 12px/1 system-ui, -apple-system, sans-serif;
  font-variant-numeric: tabular-nums;
  transition: all 0.2s ease;
  pointer-events: none;
  opacity: 0.8;
}
#pc-token-counter[data-empty="true"] { opacity: 0.4; }
#pc-token-counter[data-level="warning"] { color: #f59e0b; border-color: rgba(245,158,11,0.3); }
#pc-token-counter[data-level="danger"] { color: #ef4444; border-color: rgba(239,68,68,0.3); }
#pc-token-counter .pc-token-count { font-weight: 600; }
#pc-token-counter .pc-token-label { opacity: 0.7; }

/* ========================================
   Prompt Templates Popover
   ======================================== */
#pc-template-popover {
  position: fixed;
  z-index: 2147483647;
  width: 280px;
  max-height: 300px;
  background: var(--main-surface-background, rgba(25,25,25,0.98));
  border: 1px solid var(--border-light, rgba(255,255,255,0.12));
  border-radius: 12px;
  box-shadow: 0 8px 24px rgba(0,0,0,0.4);
  overflow: hidden;
  font: 13px/1.4 system-ui, -apple-system, sans-serif;
  color: var(--text-primary, #eaeaea);
}
#pc-template-popover.hidden { display: none; }

.pc-template-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 8px 12px;
  background: rgba(255,255,255,0.04);
  border-bottom: 1px solid var(--border-light, rgba(255,255,255,0.08));
}
.pc-template-title { font-weight: 600; font-size: 12px; text-transform: uppercase; letter-spacing: 0.5px; opacity: 0.7; }
.pc-template-manage {
  border: none;
  background: transparent;
  color: inherit;
  cursor: pointer;
  padding: 4px;
  border-radius: 4px;
  opacity: 0.6;
  transition: opacity 0.15s;
}
.pc-template-manage:hover { opacity: 1; background: rgba(255,255,255,0.08); }

.pc-template-list {
  max-height: 200px;
  overflow-y: auto;
  padding: 6px;
}
.pc-template-item {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 8px 10px;
  border-radius: 8px;
  cursor: pointer;
  transition: background 0.1s;
}
.pc-template-item:hover { background: rgba(255,255,255,0.06); }
.pc-template-item.selected { background: rgba(59,130,246,0.2); }
.pc-template-trigger {
  font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace;
  font-size: 12px;
  padding: 2px 6px;
  background: rgba(255,255,255,0.08);
  border-radius: 4px;
  color: #60a5fa;
}
.pc-template-name { flex: 1; opacity: 0.9; }
.pc-template-empty { padding: 16px; text-align: center; opacity: 0.5; }

.pc-template-hint {
  padding: 8px 12px;
  font-size: 11px;
  color: var(--text-secondary, #888);
  border-top: 1px solid var(--border-light, rgba(255,255,255,0.06));
}
.pc-template-hint kbd {
  display: inline-block;
  padding: 1px 5px;
  background: rgba(255,255,255,0.1);
  border-radius: 3px;
  font-family: inherit;
  font-size: 10px;
}

/* ========================================
   Template Manager Modal
   ======================================== */
#pc-template-manager {
  position: fixed;
  inset: 0;
  z-index: 2147483647;
  display: flex;
  align-items: center;
  justify-content: center;
  font: 14px/1.5 system-ui, -apple-system, sans-serif;
  color: var(--text-primary, #eaeaea);
}
#pc-template-manager.hidden { display: none; }

.pc-manager-backdrop {
  position: absolute;
  inset: 0;
  background: rgba(0,0,0,0.6);
  backdrop-filter: blur(4px);
}

.pc-manager-dialog {
  position: relative;
  width: 480px;
  max-width: 90vw;
  max-height: 80vh;
  background: var(--main-surface-background, #1a1a1a);
  border: 1px solid var(--border-light, rgba(255,255,255,0.1));
  border-radius: 16px;
  box-shadow: 0 24px 48px rgba(0,0,0,0.5);
  overflow: hidden;
  display: flex;
  flex-direction: column;
}

.pc-manager-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 16px 20px;
  border-bottom: 1px solid var(--border-light, rgba(255,255,255,0.08));
}
.pc-manager-header h2 { margin: 0; font-size: 18px; font-weight: 600; }
.pc-manager-close {
  border: none;
  background: transparent;
  color: inherit;
  font-size: 24px;
  cursor: pointer;
  padding: 4px 8px;
  border-radius: 6px;
  line-height: 1;
  opacity: 0.6;
}
.pc-manager-close:hover { opacity: 1; background: rgba(255,255,255,0.08); }

.pc-manager-body {
  flex: 1;
  overflow-y: auto;
  padding: 16px 20px;
}
.pc-manager-body.hidden { display: none; }

.pc-manager-list {
  display: flex;
  flex-direction: column;
  gap: 8px;
  margin-bottom: 16px;
}

.pc-manager-item {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 12px 14px;
  background: rgba(255,255,255,0.04);
  border: 1px solid var(--border-light, rgba(255,255,255,0.08));
  border-radius: 10px;
  transition: background 0.15s;
}
.pc-manager-item:hover { background: rgba(255,255,255,0.06); }

.pc-manager-item-info { display: flex; align-items: center; gap: 10px; }
.pc-manager-item-trigger {
  font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace;
  font-size: 13px;
  padding: 3px 8px;
  background: rgba(59,130,246,0.15);
  color: #60a5fa;
  border-radius: 5px;
}
.pc-manager-item-name { font-weight: 500; }

.pc-manager-item-actions { display: flex; gap: 6px; }
.pc-manager-item-actions button {
  border: none;
  background: transparent;
  color: inherit;
  padding: 6px;
  border-radius: 6px;
  cursor: pointer;
  opacity: 0.5;
  transition: opacity 0.15s, background 0.15s;
}
.pc-manager-item-actions button:hover { opacity: 1; background: rgba(255,255,255,0.1); }
.pc-manager-delete:hover { color: #ef4444 !important; }

.pc-manager-add {
  width: 100%;
  padding: 12px;
  border: 1px dashed var(--border-light, rgba(255,255,255,0.15));
  border-radius: 10px;
  background: transparent;
  color: var(--text-secondary, #888);
  font-size: 14px;
  cursor: pointer;
  transition: all 0.15s;
}
.pc-manager-add:hover {
  background: rgba(255,255,255,0.04);
  border-color: rgba(255,255,255,0.25);
  color: var(--text-primary, #eaeaea);
}

/* Template Editor within Modal */
.pc-manager-editor {
  padding: 16px 20px;
}
.pc-manager-editor.hidden { display: none; }

.pc-editor-field {
  margin-bottom: 16px;
}
.pc-editor-field label {
  display: block;
  margin-bottom: 6px;
  font-size: 13px;
  font-weight: 500;
  color: var(--text-secondary, #aaa);
}
.pc-editor-hint {
  font-weight: normal;
  font-size: 11px;
  opacity: 0.6;
  margin-left: 8px;
}

.pc-editor-field input,
.pc-editor-field textarea {
  width: 100%;
  padding: 10px 12px;
  border: 1px solid var(--border-light, rgba(255,255,255,0.12));
  border-radius: 8px;
  background: rgba(0,0,0,0.3);
  color: var(--text-primary, #eaeaea);
  font: inherit;
  font-size: 14px;
  outline: none;
  transition: border-color 0.15s;
  box-sizing: border-box;
}
.pc-editor-field input:focus,
.pc-editor-field textarea:focus {
  border-color: rgba(59,130,246,0.5);
}
.pc-editor-field textarea {
  resize: vertical;
  min-height: 120px;
  font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace;
  font-size: 13px;
}

.pc-editor-actions {
  display: flex;
  justify-content: flex-end;
  gap: 10px;
  margin-top: 20px;
}
.pc-editor-actions button {
  padding: 10px 20px;
  border-radius: 8px;
  font-size: 14px;
  font-weight: 500;
  cursor: pointer;
  transition: all 0.15s;
}
.pc-editor-cancel {
  border: 1px solid var(--border-light, rgba(255,255,255,0.15));
  background: transparent;
  color: var(--text-primary, #eaeaea);
}
.pc-editor-cancel:hover { background: rgba(255,255,255,0.06); }
.pc-editor-save {
  border: none;
  background: #3b82f6;
  color: #fff;
}
.pc-editor-save:hover { background: #2563eb; }
